---
sidebar_position: 8
---

# 系统架构

MesaLogo 采用分层架构设计，从基础设施到应用场景层层递进，提供完整的多智能体协作决策解决方案。

## 架构总览

```
┌─────────────────────────────────────────────────────────────┐
│                      场景应用层                              │
│  企业决策 | 医疗会诊 | 教育培训 | 软件研发 | 供应链管理      │
├─────────────────────────────────────────────────────────────┤
│                      智能体中台                              │
│  双引擎规则系统 | 行动空间管理 | 智能体管理 | 会话管理       │
│  MCP工具集成 | 环境变量管理                                  │
├─────────────────────────────────────────────────────────────┤
│                      模型服务层                              │
│  模型管理 | 知识库服务 | 多模态服务 | MCP基础服务            │
├─────────────────────────────────────────────────────────────┤
│                      基础设施层                              │
│  数据库 | 文件存储 | 缓存系统 | 日志监控 | 安全系统          │
└─────────────────────────────────────────────────────────────┘
```

## 场景应用层

场景应用层提供针对不同行业和场景的专业解决方案：

| 场景 | 描述 | 典型用例 |
|------|------|----------|
| 企业决策 | 战略制定、团队协作、项目管理 | 投资决策分析、组织结构优化 |
| 医疗会诊 | 多专家诊断讨论和治疗方案制定 | 复杂病例多学科会诊 |
| 教育培训 | 模拟课堂讨论、案例分析、辩论训练 | 法学院模拟法庭 |
| 软件研发 | 需求分析、技术评审、代码审查 | 敏捷开发团队协作 |
| 供应链管理 | 供应商协商、库存决策、物流优化 | 多供应商风险预警 |

## 智能体中台

智能体中台是系统的核心，提供智能体协作的基础设施。

### 双引擎规则系统

创新性地结合两种规则引擎：

- **自然语言规则引擎**：处理复杂语义和模糊条件
  - 示例："当需求变更频繁且影响核心功能时，需重新评估项目时间线"
  
- **逻辑规则引擎**：处理精确计算和确定性逻辑
  - 示例："当缺陷密度 > 2/KLOC 且测试覆盖率 < 85% 时，推迟发布"

- **规则冲突解决机制**：智能处理规则之间的冲突和优先级

### 行动空间管理

- **行动空间管理器**：创建和管理行动空间（场景模板）
- **ODD框架支持**：基于 Overview, Design concepts, Details 标准框架
- **行动任务管理器**：管理具体的行动任务实例
- **监督者机制**：监控和干预智能体交互

### 智能体管理

- **智能体管理器**：创建和管理智能体实例
- **角色管理器**：定义和管理专业角色模板
- **能力管理器**：管理智能体的能力和工具配置

### 会话管理

- **会话管理器**：管理智能体之间的会话
- **消息处理器**：处理消息的格式化和转换
- **自动讨论机制**：支持智能体自主讨论
- **工具调用处理器**：处理智能体的工具调用

### MCP工具集成

- **MCP服务器管理器**：管理 MCP 服务器的生命周期
- **外部工具集成**：集成各种外部工具和服务
- **变量服务器**：提供变量访问服务

### 环境变量管理

- **变量模板管理器**：管理变量模板定义
- **任务环境变量管理器**：管理任务级公共变量
- **智能体变量管理器**：管理智能体私有变量

## 模型服务层

### 模型管理

- **模型客户端**：处理与 LLM API 的通信
- **模型管理服务**：管理模型配置、参数和访问控制

支持的模型：
- OpenAI (GPT-3.5, GPT-4)
- Anthropic Claude
- Google Gemini
- 国内大模型（通义千问、文心一言等）

### 知识库服务

| 服务 | 功能 | 特点 |
|------|------|------|
| LightRAG | 轻量级 RAG | 快速检索，适合中小规模知识库 |
| GraphRAG | 知识图谱 RAG | 复杂知识关系的表示和查询 |
| Graphiti | 时间敏感图谱 | 时间越久远的知识权重越低 |

### 多模态服务

- **图像识别分析**：处理图像输入
- **图像生成服务**：生成各类图像内容
- **音频处理服务**：语音识别和合成

### MCP基础服务

- **MCP服务器**：提供 Model-Control-Protocol 标准接口
- **外部应用连接器**：连接第三方应用和服务
- **内部工具服务器**：提供系统内部工具的访问接口

## 基础设施层

| 组件 | 功能 |
|------|------|
| 数据库 | 存储系统核心数据（PostgreSQL/MySQL） |
| 文件存储 | 存储大型文件、日志和系统资源 |
| 缓存系统 | 提高系统性能，缓存常用数据 |
| 日志系统 | 记录系统运行日志，支持问题排查 |
| 监控系统 | 监控系统运行状态，提供性能指标 |
| 安全系统 | 身份认证、权限控制和数据加密 |

## 核心资源关系

### 模板层与实例层

```
模板层                          实例层
──────                          ──────
ActionSpace (行动空间)    →     ActionTask (行动任务)
Role (角色)               →     Agent (智能体)
RuleSet (规则集)          →     (应用于任务)
Knowledge (知识库)        →     (智能体访问)
```

### 资源关系图

```
ActionSpace (场景模板)
    ├── Role[] (角色模板)
    ├── RuleSet[] (规则集)
    └── SharedVariable[] (共享变量)
           │
           ↓ 创建任务
ActionTask (场景实例)
    ├── Agent[] (智能体实例)
    ├── Conversation[] (会话)
    └── EnvironmentVariable[] (环境变量)
           │
           ↓
Conversation (对话)
    ├── Message[] (消息)
    └── AutonomousTask[] (自主任务)
```

## 技术栈

### 后端

- **语言**：Python 3.9+
- **框架**：Flask
- **数据库**：PostgreSQL / MySQL
- **缓存**：Redis

### 前端

- **框架**：React 18
- **语言**：TypeScript
- **UI库**：Ant Design
- **状态管理**：React Context

### 部署

- **容器化**：Docker
- **编排**：Docker Compose
- **反向代理**：Nginx
